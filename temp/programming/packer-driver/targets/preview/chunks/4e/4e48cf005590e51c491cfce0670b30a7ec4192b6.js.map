{"version":3,"sources":["file:///Users/michael/Desktop/gitfiles/coscos_oop_frame_wrok/assets/core/Root.ts"],"names":["_decorator","Component","director","JsonAsset","Node","sys","screen","game","Game","Fwk","version","UIMgr","ResManager","property","config_name","Root","type","tooltip","persist","onLoad","log","trace","enabled","initModule","startup","update","deltaTime","loadGameConfig","uiMgr","initLayer","uiRoot","initGui","run","error","jsonInfo","resMgr","load","paths","Error","addPersistRootNode","init","on","EVENT_SHOW","onShow","EVENT_HIDE","onHide","isMobile","resume","pause"],"mappings":"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","sourcesContent":["import { _decorator, Component, director, JsonAsset, log, Node, sys, UI, screen, game, Game } from 'cc';\nimport { Fwk, version } from './Fwks';\nimport { UIMgr } from './gui/UIMgr';\nimport { ResManager } from './common/loader/ResManager';\nconst { property } = _decorator;\n\n\nconst config_name = \"game_config\";\n\nexport class Root extends Component {\n\n    /** 游戏层节点 */\n    @property({\n        type: Node,\n        tooltip: 'Game  Node',\n    })\n    gameRoot: Node = null!;\n\n    /** UI 层节点 */\n    @property({\n        type: Node,\n        tooltip: 'UI  Node',\n    })\n    uiRoot: Node = null!;\n\n    /** 框架常驻节点 */\n    private persist: Node = null!\n\n    onLoad(): void {\n\n        Fwk.log.trace(`Framework ${version}`)\n        this.enabled = false;\n\n        this.initModule()\n\n        this.startup();\n\n    }\n\n\n    update(deltaTime: number) {\n\n    }\n\n\n    /** 启动流程 */\n    private async startup() {\n        try {\n            // 1. 加载配置\n            await this.loadGameConfig();\n\n            Fwk.log.trace(\"游戏配置加载完成\");\n\n            // 2. 初始化 UI 层\n            Fwk.uiMgr.initLayer(this.uiRoot);\n\n            // 3. 初始化游戏界面\n            this.initGui();\n\n            // 4. 启动游戏\n            this.run();\n\n            // 5. 启用更新\n            this.enabled = true;\n\n\n\n        } catch (error) {\n            Fwk.log.error(\"游戏启动失败:\", error);\n            // TODO: 显示错误提示界面\n            // this.showErrorUI(\"游戏加载失败,请重试\");\n        }\n    }\n\n\n    private async loadGameConfig() {\n\n        const jsonInfo = await Fwk.resMgr.load({\n            paths: config_name,\n            type: JsonAsset\n        });\n\n        if (jsonInfo == null) {\n            throw new Error(`配置文件 ${config_name} 加载失败`);\n        }\n\n        // TODO: 解析配置到 Fwk.config\n        // Fwk.config = jsonInfo.json;\n\n    }\n\n\n\n    /** 初始化模块 */\n    private initModule() {\n        /** \n         * 创建常驻节点\n         * 绑定 时间管理器 音频模块\n         */\n        this.persist = new Node(\"FwkPersistNode\")\n        director.addPersistRootNode(this.persist)\n\n\n        Fwk.resMgr = new ResManager()\n\n        // LayerMgr\n        Fwk.uiMgr = new UIMgr()\n\n\n\n    }\n\n\n    /** 初始化游戏界面 */\n    protected initGui() {\n\n    }\n\n\n    /** 加载完引擎配置文件后执行 */\n    protected run() {\n\n    }\n\n\n\n    private init() {\n        // 初始化游戏界面\n        this.initGui();\n\n        // ecs 初始化\n\n        // 游戏显示事件\n        game.on(Game.EVENT_SHOW, this.onShow, this);\n        // 游戏隐藏事件\n        game.on(Game.EVENT_HIDE, this.onHide, this);\n\n        // 游戏尺寸修改事件\n        if (!sys.isMobile) {\n            screen.on(\"window-resize\", () => {\n                // 派发游戏窗口尺寸变化事件\n            }, this);\n\n            screen.on(\"fullscreen-change\", () => {\n                // 派发游戏全屏事件\n            }, this);\n        }\n\n        screen.on(\"orientation-change\", () => {\n            // 派发游戏方向变化事件\n        }, this);\n    }\n\n\n    private onShow() {\n\n        // TODO:处理回到游戏时减去逝去时间\n\n        // TODO:恢复所有暂停的音乐播放\n\n        // 恢复暂停场景的游戏逻辑，如果当前场景没有暂停将没任何事情发生\n        director.resume();\n\n        // 恢复游戏主循环。包含：游戏逻辑，渲染，事件处理，背景音乐和所有音效\n        game.resume();\n\n        // TODO:框架事件派发 gameshow\n    }\n\n    private onHide() {\n        // TODO:处理切到后台后记录切出时间\n\n        // TODO:处理暂停所有音乐播放\n\n        // 暂停正在运行的场景，该暂停只会停止游戏逻辑执行，但是不会停止渲染和 UI 响应。 如果想要更彻底得暂停游戏，包含渲染，音频和事件处理，请使用 game.pause()\n        director.pause();\n\n        // 暂停游戏主循环。包含：游戏逻辑、渲染、输入事件派发（Web 和小游戏平台除外），背景音乐和所有音效\n        game.pause();\n\n\n        // TODO:框架事件派发 gamehide\n\n    }\n\n\n\n}\n\n"]}