{"version":3,"sources":["file:///Users/michael/Desktop/gitfiles/coscos_oop_frame_wrok/assets/core/gui/UIMgr.ts"],"names":["UIMgr","Node","Camera","LayerContainerType","LayerType","utils","UIGameLayerNode","uiConfigRegistry","Fwk","UILayerNodeBase","UISingletonLayerNode","UIMultiLayerNode","UIViewState","layerMap","UIScene","Multi","PopUp","Notify","Single","Guide","Top","constructor","uiRoot","uiCamera","uiLayersMap","Map","uiGameLayerNode","initLayer","getComponentInChildren","layerEntries","enumEntries","sort","a","b","Number","layerName","layerTypeValue","layerType","layerNode","UIGame","n","containerType","addChild","set","containerTypeName","log","debug","registerUIComponents","configMap","init","open","viewId","param","uiConfig","get","error","layer","uiInfo","node","addView","Promise","reject","close","removeView","prefab"],"mappings":"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","sourcesContent":["\nimport { Node, Camera } from \"cc\";\nimport { LayerContainerType, LayerType, UIType } from \"../common/enum/ui-layer.enum\";\nimport { utils } from \"../common/utils/utils\";\nimport { UIGameLayerNode } from \"./layer/UIGameLayerNode\";\nimport { UIComponentConfig, UIConfigMap } from 'db://assets/core/common/struct/ui-structs';\nimport { uiConfigRegistry } from \"./UIConfigRegistry\";\nimport { UIComponentParam } from 'db://assets/core/common/struct/ui-structs';\nimport { Fwk } from \"../Fwks\";\nimport { UILayerNodeBase } from \"./base/UILayerNodeBase\";\nimport { UISingletonLayerNode } from \"./base/UISingletonLayerNode\";\nimport { UIMultiLayerNode } from \"./base/UIMultiLayerNode\";\nimport { UIViewState } from \"./base/UIViewState\";\n\nconst layerMap: Partial<Record<LayerType, LayerContainerType>> = {\n    [LayerType.UIScene]: LayerContainerType.Multi,\n    [LayerType.PopUp]: LayerContainerType.Multi,\n    [LayerType.Notify]: LayerContainerType.Single,\n    [LayerType.Guide]: LayerContainerType.Single,\n    [LayerType.Top]: LayerContainerType.Single,\n}\n\nexport class UIMgr {\n    /** UI 根节点 */\n    uiRoot!: Node;\n    /** UI 摄像机 */\n    uiCamera!: Camera\n\n    /** 界面层集合 - 无自定义类型 */\n    private uiLayersMap: Map<string, UILayerNodeBase> = new Map<string, UILayerNodeBase>();\n\n    private uiGameLayerNode!: UIGameLayerNode;\n\n    constructor() {\n    }\n\n    /** \n     * 初始化 UI节点\n     * @param uiRoot UI 根节点\n     */\n    initLayer(uiRoot: Node): void {\n\n        this.uiRoot = uiRoot;\n\n        this.uiCamera = this.uiRoot.getComponentInChildren(Camera)!;\n\n        // 按枚举值升序排序后遍历\n        const layerEntries = utils.enumEntries(LayerType).sort((a, b) => Number(a[1]) - Number(b[1]));\n\n        for (const [layerName, layerTypeValue] of layerEntries) {\n            const layerType = Number(layerTypeValue) as LayerType;\n\n            let layerNode: Node;\n\n            // 特殊处理 UIGame 层\n            if (layerType === LayerType.UIGame) {\n                const n = new UIGameLayerNode(layerName);\n                this.uiGameLayerNode = n;\n                layerNode = n;\n            } else {\n                // 从 layerMap 获取容器类型\n                const containerType = layerMap[layerType];\n\n                // 根据容器类型创建对应的层节点\n                if (containerType === LayerContainerType.Single) {\n                    layerNode = new UISingletonLayerNode(layerName);\n                } else if (containerType === LayerContainerType.Multi) {\n                    layerNode = new UIMultiLayerNode(layerName);\n                } else {\n                    // 未配置则默认创建普通节点\n                    layerNode = new Node(layerName);\n                }\n            }\n\n            // 将创建的节点加入 uiRoot 并记录\n            this.uiRoot.addChild(layerNode);\n            if (layerNode instanceof UILayerNodeBase) {\n                this.uiLayersMap.set(layerName, layerNode);\n            }\n\n            const containerTypeName = layerMap[layerType] || 'None';\n            Fwk.log.debug(`[UIMgr] Created layer: ${layerName} (LayerType: ${LayerType[layerType]}, Container: ${containerTypeName})`);\n        }\n    }\n\n\n    /** \n     * 注册 UI 组件\n     * @param configMap UI 组件配置映射表\n     */\n    registerUIComponents(configMap: UIConfigMap): void {\n        uiConfigRegistry.init(configMap);\n    }\n\n\n\n    public async open(viewId: string, param?: UIComponentParam): Promise<Node> {\n        const uiConfig: UIComponentConfig = uiConfigRegistry.get(viewId);\n\n        if (!uiConfig) {\n            Fwk.log.error(`UI 配置未找到: ${viewId}`);\n            return null;\n        }\n\n    \n\n        let layerNode = this.uiLayersMap.get(uiConfig.layer);\n        if (!layerNode) {\n            Fwk.log.error(`UI 层未找到: ${uiConfig.layer} for viewId: ${viewId}`);\n            return null;\n        }\n\n        // 创建 UIViewState 实例\n        let uiInfo = new UIViewState().init(viewId, uiConfig, param);\n\n        let node = await layerNode.addView(uiInfo);\n\n        if (!node) {\n            Fwk.log.error(`UI 打开失败: ${viewId} on layer: ${uiConfig.layer}`);\n            return Promise.reject(`UI 打开失败: ${viewId} on layer: ${uiConfig.layer}`);\n        }\n\n        return node;\n\n    }\n\n    public close(viewId: string): void {\n        const uiConfig: UIComponentConfig = uiConfigRegistry.get(viewId);\n\n        if (!uiConfig) {\n            Fwk.log.error(`UI 配置未找到: ${viewId}`);\n            return;\n        }\n\n        let layerNode = this.uiLayersMap.get(uiConfig.layer);\n        if (!layerNode) {\n            Fwk.log.error(`UI 层未找到: ${uiConfig.layer} for viewId: ${viewId}`);\n            return;\n        }\n\n        layerNode.removeView(uiConfig.prefab);\n    }\n\n\n}\n"]}