{"version":3,"sources":["file:///Users/michael/Desktop/gitfiles/coscos_oop_frame_wrok/assets/core/gui/layer/UIElementComponent.ts"],"names":["_decorator","Component","UIComponentBase","ccclass","property","UIElementComponent","uiInfo","onClose","initializeUI","Promise","resolve","reject","i","node","components","length","component","result","onAdded","params","data","finalizeRemoveUI","valid","onBeforeRemove","destroyNode","triggerComponentsOnRemoved","destroy","removeFromLayer","removeFromParent","onRemoved","onDestroy"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;AAEZC,MAAAA,e,iBAAAA,e;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;AAG9B;AACA;AACA;AACA;AACA;AACA;AACA;;oCAEaK,kB,WADZF,OAAO,CAAC,oBAAD,C,gBAAR,MACaE,kBADb,SACwCJ,SADxC,CACkD;AAAA;AAAA;;AAC9C;AAD8C,eAE9CK,MAF8C,GAExB,IAFwB;;AAG9C;AAH8C,eAI9CC,OAJ8C,GAI1B,IAJ0B;AAAA;;AAM9C;AACJ;AACA;AACA;AACIC,QAAAA,YAAY,GAAqB;AAC7B,iBAAO,IAAIC,OAAJ,CAAY,OAAOC,OAAP,EAAgBC,MAAhB,KAA2B;AAE1C;AACZ;AACA;AACY,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKC,IAAL,CAAUC,UAAV,CAAqBC,MAAzC,EAAiDH,CAAC,EAAlD,EAAsD;AAElD,oBAAMI,SAAS,GAAG,KAAKH,IAAL,CAAUC,UAAV,CAAqBF,CAArB,CAAlB;AAEA,kBAAI,EAAEI,SAAS;AAAA;AAAA,qDAAX,CAAJ,EAA6C;AAE7C,oBAAMC,MAAM,GAAG,MAAMD,SAAS,CAACE,OAAV,CAAkB,KAAKZ,MAAL,CAAYa,MAAZ,CAAmBC,IAArC,CAArB;;AACA,kBAAIH,MAAM,KAAK,KAAf,EAAsB;AAClBP,gBAAAA,OAAO,CAAC,KAAD,CAAP;AACA;AACH;AACJ;;AAEDA,YAAAA,OAAO,CAAC,IAAD,CAAP;AACH,WAnBM,CAAP;AAoBH;AAED;AACJ;AACA;;;AACIW,QAAAA,gBAAgB,GAAS;AACrB,cAAI,KAAKf,MAAL,CAAYgB,KAAZ,KAAsB,KAA1B,EAAiC;;AAEjC,eAAK,IAAIV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKC,IAAL,CAAUC,UAAV,CAAqBC,MAAzC,EAAiDH,CAAC,EAAlD,EAAsD;AAElD,kBAAMI,SAAS,GAAG,KAAKH,IAAL,CAAUC,UAAV,CAAqBF,CAArB,CAAlB;AAEA,gBAAI,EAAEI,SAAS;AAAA;AAAA,mDAAX,CAAJ,EAA6C;AAE7CA,YAAAA,SAAS,CAACO,cAAV;AACH;;AAED,eAAKhB,OAAL,IAAgB,KAAKA,OAAL,EAAhB;AAEH;AAED;AACJ;AACA;;;AACWiB,QAAAA,WAAW,GAAS;AAEvB;AAEA,eAAKC,0BAAL,GAJuB,CAMvB;;AACA,eAAKZ,IAAL,CAAUa,OAAV;AAEH;AAED;AACJ;AACA;AACA;;;AACWC,QAAAA,eAAe,GAAS;AAC3B,eAAKd,IAAL,CAAUe,gBAAV;AACA,eAAKH,0BAAL;AACH;AAGD;AACJ;AACA;;;AAEWA,QAAAA,0BAA0B,GAAS;AACtC,eAAK,IAAIb,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKC,IAAL,CAAUC,UAAV,CAAqBC,MAAzC,EAAiDH,CAAC,EAAlD,EAAsD;AAClD,kBAAMI,SAAS,GAAG,KAAKH,IAAL,CAAUC,UAAV,CAAqBF,CAArB,CAAlB;AACA,gBAAI,EAAEI,SAAS;AAAA;AAAA,mDAAX,CAAJ,EAA6C;AAC7CA,YAAAA,SAAS,CAACa,SAAV;AACH;AACJ;;AACDC,QAAAA,SAAS,GAAG;AACR,eAAKxB,MAAL,GAAc,IAAd;AACA,eAAKC,OAAL,GAAe,IAAf;AACH;;AA1F6C,O","sourcesContent":["import { _decorator, Component, Node as CCNode } from 'cc';\nimport { UIViewState } from '../base/UIViewState';\nimport { UIComponentBase } from '../base/UICompBase';\nimport { Fwk } from '../../Fwks';\nconst { ccclass, property } = _decorator;\n\n\n/**\n * UI 元素组件基类\n * 用于管理 UI的生命周期和行为\n * @export\n * @class UIElementComponent\n * @extends {Component}\n */\n@ccclass('UIElementComponent')\nexport class UIElementComponent extends Component {\n    /** 视图参数 */\n    uiInfo: UIViewState = null!;\n    /** 关闭窗口之前 */\n    onClose: Function = null!;\n\n    /**\n     * 初始化界面元素，触发所有 UI 组件的 onAdded 事件\n     * @returns {Promise<boolean>} 返回一个 Promise，解析为 true 表示初始化成功，false 表示被中断\n     */\n    initializeUI(): Promise<boolean> {\n        return new Promise(async (resolve, reject) => {\n\n            /**\n             * 触发所有挂载在节点上的 UI 组件的 onAdded 事件\n             */\n            for (let i = 0; i < this.node.components.length; i++) {\n\n                const component = this.node.components[i];\n\n                if (!(component instanceof UIComponentBase)) continue;\n\n                const result = await component.onAdded(this.uiInfo.params.data);\n                if (result === false) {\n                    resolve(false);\n                    return;\n                }\n            }\n\n            resolve(true);\n        });\n    }\n\n    /**\n     * 触发 onBeforeRemove 事件，并执行关闭前的回调\n     */\n    finalizeRemoveUI(): void {\n        if (this.uiInfo.valid === false) return;\n\n        for (let i = 0; i < this.node.components.length; i++) {\n\n            const component = this.node.components[i];\n\n            if (!(component instanceof UIComponentBase)) continue;\n\n            component.onBeforeRemove();\n        }\n\n        this.onClose && this.onClose();\n\n    }\n\n    /**\n     * 销毁节点并释放资源\n     */\n    public destroyNode(): void {\n\n        // 先触发组件的 onRemoved\n\n        this.triggerComponentsOnRemoved();\n\n        // 销毁节点\n        this.node.destroy();\n\n    }\n\n    /**\n     * 从 层级 中移除 ViewNode\n     * 支持 界面缓存 逻辑\n     */\n    public removeFromLayer(): void {\n        this.node.removeFromParent();\n        this.triggerComponentsOnRemoved();\n    }\n\n\n    /**\n     * 触发所有 UI 组件的 onRemoved 事件\n     */\n\n    public triggerComponentsOnRemoved(): void {\n        for (let i = 0; i < this.node.components.length; i++) {\n            const component = this.node.components[i];\n            if (!(component instanceof UIComponentBase)) continue;\n            component.onRemoved();\n        }\n    }\n    onDestroy() {\n        this.uiInfo = null!;\n        this.onClose = null!;\n    }\n\n\n\n}\n\n"]}